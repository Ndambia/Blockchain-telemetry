; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = esp32dev

; ============================================================
; Default Environment - ESP32 Development Board
; ============================================================
[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; ============================================================
; Serial Monitor Configuration
; ============================================================
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder    ; Decode ESP32 crash dumps
    colorize                   ; Add color to output
    time                       ; Add timestamps
monitor_rts = 0
monitor_dtr = 0

; ============================================================
; Upload Configuration
; ============================================================
upload_speed = 921600
upload_port = 
    ; Auto-detect upload port
    ; Uncomment and specify if auto-detection fails:
    ; COM3              ; Windows
    ; /dev/ttyUSB0      ; Linux
    ; /dev/cu.usbserial ; macOS

; ============================================================
; Build Flags
; ============================================================
build_flags = 
    ; Debug level (0=None, 1=Error, 2=Warn, 3=Info, 4=Debug, 5=Verbose)
    -D CORE_DEBUG_LEVEL=3
    
    ; Enable colored Arduino log output
    -D CONFIG_ARDUHAL_LOG_COLORS=1
    
    ; Optimize for size (optional, comment out for speed optimization)
    -Os
    
    ; Enable exceptions (needed for some libraries)
    -fexceptions
    
    ; Stack protection (helps catch stack overflows)
    -fstack-protector
    
    ; Custom project defines (optional)
    ; -D PROJECT_VERSION=\"1.3.0\"
    ; -D MAX_BLOCKS=50
    ; -D ENABLE_DEBUG_LOGS=1

; ============================================================
; Filesystem Configuration
; ============================================================
board_build.filesystem = spiffs

; Default partition scheme (1.5MB SPIFFS)
board_build.partitions = default.csv

; Uncomment for custom partition scheme with larger SPIFFS (~1.5MB)
; board_build.partitions = custom_partitions.csv

; SPIFFS configuration
board_build.embed_files = 
    ; Add any files you want embedded in SPIFFS here
    ; data/config.json
    ; data/cert.pem

; ============================================================
; Flash Configuration
; ============================================================
board_build.flash_mode = dio
board_build.f_flash = 40000000L
board_build.f_cpu = 240000000L

; ============================================================
; Library Dependencies
; ============================================================
lib_deps = 
    ; No external libraries required - all dependencies are built-in:
    ; - esp_now.h (ESP-NOW protocol)
    ; - WiFi.h (WiFi functionality)
    ; - mbedtls/md.h (Cryptographic functions)
    ; - SPIFFS.h (Filesystem)
    ; - Preferences.h (NVS storage)
    ; - FS.h (File system base)
    
    ; Add external libraries here if needed in future:
    ; bblanchon/ArduinoJson@^6.21.0
    ; https://github.com/me-no-dev/ESPAsyncWebServer.git

; ============================================================
; Advanced Options
; ============================================================
; Uncomment to enable additional checks
check_tool = cppcheck
check_flags = 
    cppcheck: --enable=all

; Uncomment to use custom build script
; extra_scripts = 
;     pre:scripts/pre_build.py
;     post:scripts/post_build.py

; ============================================================
; Additional Test Environment (Optional)
; ============================================================
; [env:esp32dev-test]
; extends = env:esp32dev
; build_flags = 
;     ${env:esp32dev.build_flags}
;     -D UNIT_TEST=1
;     -D STRATEGY_ALL_VALIDATOR=1

; ============================================================
; Production Environment with Optimizations (Optional)
; ============================================================
[env:esp32dev-release]
extends = env:esp32dev
build_type = release
build_flags = 
    ${env:esp32dev.build_flags}
    -D CORE_DEBUG_LEVEL=1      ; Minimal logging
    -O3                         ; Maximum optimization
    -DNDEBUG                    ; Disable assertions
monitor_speed = 115200

; ============================================================
; OTA Update Environment (Optional)
; ============================================================
; [env:esp32dev-ota]
; extends = env:esp32dev
; upload_protocol = espota
; upload_port = 192.168.1.100  ; ESP32 IP address
; upload_flags = 
;     --port=3232
;     --auth=your-ota-password

; ============================================================
; Custom Partition with Maximum SPIFFS
; ============================================================
[env:esp32dev-maxspiffs]
extends = env:esp32dev
board_build.partitions = custom_partitions.csv
build_flags = 
    ${env:esp32dev.build_flags}
    -D MAX_BLOCKS=100           ; More blocks with larger SPIFFS

; ============================================================
; Debug Environment with Maximum Verbosity
; ============================================================
[env:esp32dev-debug]
extends = env:esp32dev
build_type = debug
build_flags = 
    ${env:esp32dev.build_flags}
    -D CORE_DEBUG_LEVEL=5       ; Maximum debug output
    -Og                         ; Optimize for debugging
    -ggdb3                      ; Maximum debug symbols
monitor_filters = 
    esp32_exception_decoder
    colorize
    time
    log2file                    ; Save log to file

; ============================================================
; Environment for Multiple Boards (Optional)
; ============================================================
; [env:esp32-wrover]
; extends = env:esp32dev
; board = esp32-wrover-kit
; board_build.partitions = custom_partitions.csv

; [env:esp32-s3]
; extends = env:esp32dev
; board = esp32-s3-devkitc-1
; platform = espressif32@^6.0.0